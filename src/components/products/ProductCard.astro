---
import type { Product } from "../../types/Product";
import AvailabilityBadge from "./AvailabilityBadge.astro";

export interface Props {
  product: Product;
  slug?: string;
}

const { product, slug } = Astro.props;
// Tymczasowo ustawiamy domyślne wartości dla prostego schematu
const originalPrice = product.originalPrice || 299.99;
const salePrice = product.salePrice || 249.99;
const savings = originalPrice - salePrice;
const savingsPercent = Math.round((savings / originalPrice) * 100);
const modalId = `modal-${slug || product.slug || "product"}`;
---

<div
  class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden"
>
  <!-- Product Image -->
  <div class="relative">
    <img
      src={product.mainImage || "/images/products/placeholder.jpg"}
      alt={product.name || product.title}
      class="w-full h-64 object-contain bg-gray-100"
      loading="lazy"
    />
    <div class="absolute top-3 left-3">
      <AvailabilityBadge
        availability={product.availability || "available"}
        showText={false}
      />
    </div>
    {
      product.nfzRefundable && (
        <div class="absolute top-3 right-3">
          <div class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-medium">
            NFZ {product.nfzRefundPercentage || 80}%
          </div>
        </div>
      )
    }
    {
      product.rentalAvailable && (
        <div class="absolute bottom-3 left-3">
          <div class="bg-pink-100 text-pink-800 text-xs px-2 py-1 rounded-full font-medium">
            Wynajem możliwy
          </div>
        </div>
      )
    }
  </div>

  <!-- Product Info -->
  <div class="p-4">
    <h3 class="font-bold text-gray-800 mb-2 line-clamp-2 h-12">
      {product.name || product.title}
    </h3>

    <!-- Pricing -->
    <div class="mb-4">
      <div class="flex items-center space-x-2">
        <p class="text-gray-400 line-through text-sm">
          {originalPrice.toFixed(2)} zł
        </p>
        <p class="text-2xl font-bold text-primary-500">
          {salePrice.toFixed(2)} zł
        </p>
      </div>
      <p class="text-sm text-primary-500 font-medium">
        Oszczędzasz {savings.toFixed(2)} zł ({savingsPercent}%)
      </p>
    </div>

    <!-- Availability -->
    <div class="mb-4">
      <AvailabilityBadge availability={product.availability || "available"} />
    </div>

    <!-- Short Description -->
    <div class="mb-4">
      <p class="text-sm text-gray-600 line-clamp-2">
        {product.shortDescription || "Produkt ortopedyczny wysokiej jakości"}
      </p>
    </div>

    <!-- Action Button -->
    <button
      class="product-detail-btn w-full bg-primary-500 text-white py-3 px-4 rounded-lg hover:bg-primary-600 transition-colors font-semibold text-center block cursor-pointer"
      data-modal-id={modalId}
      data-product-slug={slug || product.slug || "test-product"}
    >
      Zobacz szczegóły
    </button>
  </div>
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
