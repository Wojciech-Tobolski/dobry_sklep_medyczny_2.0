---
import type { Product } from "../../types/Product";
import AvailabilityBadge from "./AvailabilityBadge.astro";

export interface Props {
  product: Product;
}

const { product } = Astro.props;
const savings = product.originalPrice - product.salePrice;
const savingsPercent = Math.round((savings / product.originalPrice) * 100);
---

<div
  class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden"
>
  <!-- Product Image -->
  <div class="relative">
    <img
      src={product.image}
      alt={product.name}
      class="w-full h-48 object-cover"
      loading="lazy"
    />
    <div class="absolute top-3 left-3">
      <AvailabilityBadge availability={product.availability} showText={false} />
    </div>
    {
      product.nfzRefundable && (
        <div class="absolute top-3 right-3">
          <div class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-medium">
            NFZ {product.nfzRefundPercentage}%
          </div>
        </div>
      )
    }
  </div>

  <!-- Product Info -->
  <div class="p-4">
    <h3 class="font-bold text-gray-800 mb-2 line-clamp-2 h-12">
      {product.name}
    </h3>

    <!-- Pricing -->
    <div class="mb-4">
      <div class="flex items-center space-x-2">
        <p class="text-gray-400 line-through text-sm">
          {product.originalPrice.toFixed(2)} zł
        </p>
        <p class="text-2xl font-bold text-primary-500">
          {product.salePrice.toFixed(2)} zł
        </p>
      </div>
      <p class="text-sm text-primary-500 font-medium">
        Oszczędzasz {savings.toFixed(2)} zł ({savingsPercent}%)
      </p>
    </div>

    <!-- Availability -->
    <div class="mb-4">
      <AvailabilityBadge availability={product.availability} />
    </div>

    <!-- Features Preview -->
    <div class="mb-4">
      <ul class="text-sm text-gray-600 space-y-1">
        {
          product.features.slice(0, 2).map((feature) => (
            <li class="flex items-center">
              <svg
                class="w-3 h-3 text-green-500 mr-2 flex-shrink-0"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fill-rule="evenodd"
                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                  clip-rule="evenodd"
                />
              </svg>
              {feature}
            </li>
          ))
        }
        {
          product.features.length > 2 && (
            <li class="text-xs text-gray-500">
              +{product.features.length - 2} więcej funkcji
            </li>
          )
        }
      </ul>
    </div>

    <!-- Action Button -->
    <a
      href={`/produkty/${product.slug}`}
      class="w-full bg-primary-500 text-white py-3 px-4 rounded-lg hover:bg-primary-600 transition-colors font-semibold text-center block"
    >
      Zobacz szczegóły
    </a>
  </div>
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
